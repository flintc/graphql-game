(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{49:function(e,n,t){e.exports=t(71)},69:function(e,n,t){},71:function(e,n,t){"use strict";t.r(n);var r=t(30),a=t.n(r),u=t(38),o=t(8),c=t(19),i=t(34),s=t(0),m=t.n(s),l=t(9),d=t(39),b=t.n(d),f=t(17),v=t(29),p=t(10),j=t(48),g=t(42),E=t(2),O=t(18),h=t(46),w=new j.a({uri:"https://graphql-number-guessing-game.herokuapp.com/v1/graphql"}),$=new g.a({uri:"wss://graphql-number-guessing-game.herokuapp.com/v1/graphql",options:{reconnect:!0}}),_=Object(p.d)(function(e){var n=e.query,t=Object(E.l)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation},$,w),S=new O.a({link:_,cache:new h.a}),I=t(12),q=t(13),C=t.n(q);function y(){var e=Object(I.a)(["\n  mutation NextRound($roomId: uuid) {\n    update_room(_inc: { round: 1 }, where: { id: { _eq: $roomId } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return y=function(){return e},e}function N(){var e=Object(I.a)(["\n  mutation SubmitQuestion(\n    $roomId: uuid!\n    $name: String\n    $description: String\n    $imageUrl: String\n    $answer: json\n  ) {\n    insert_question(\n      objects: [\n        {\n          room_id: $roomId\n          name: $name\n          description: $description\n          imageUrl: $imageUrl\n          answer: $answer\n        }\n      ]\n    ) {\n      affected_rows\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return N=function(){return e},e}function U(){var e=Object(I.a)(["\n  mutation CreateRoomAndUser($userName: String, $roomName: String) {\n    insert_user(\n      objects: [{ name: $userName, room: { data: { name: $roomName } } }]\n    ) {\n      affected_rows\n      returning {\n        id\n        name\n        room {\n          name\n          id\n        }\n      }\n    }\n  }\n"]);return U=function(){return e},e}function k(){var e=Object(I.a)(["\n  subscription SubscribeToAnswer($questionId: uuid, $userId: uuid) {\n    response(\n      where: { question_id: { _eq: $questionId }, owner_id: { _eq: $userId } }\n      order_by: { created_at: desc }\n      limit: 1\n    ) {\n      id\n      value\n      question {\n        name\n        answer\n      }\n    }\n  }\n"]);return k=function(){return e},e}function x(){var e=Object(I.a)(["\n  mutation SubmitAnswer($questionId: uuid, $userId: uuid, $value: Int) {\n    insert_response(\n      objects: [{ question_id: $questionId, owner_id: $userId, value: $value }]\n    ) {\n      affected_rows\n      returning {\n        id\n        value\n      }\n    }\n  }\n"]);return x=function(){return e},e}function R(){var e=Object(I.a)(["\n  query GetAnswer($questionId: uuid, $userId: uuid) {\n    response(\n      limit: 1\n      where: { question_id: { _eq: $questionId }, owner_id: { _eq: $userId } }\n    ) {\n      id\n      value\n    }\n  }\n"]);return R=function(){return e},e}function A(){var e=Object(I.a)(["\n  query FindRoomByName($name: String) {\n    room(where: { name: { _eq: $name } }) {\n      id\n      name\n    }\n  }\n"]);return A=function(){return e},e}function D(){var e=Object(I.a)(["\n  subscription SubscribeToRoom($name: String) {\n    room(where: { name: { _eq: $name } }) {\n      id\n      state\n      name\n      round\n      questions(order_by: { created_at: asc }) {\n        id\n        name\n        state\n        created_at\n        answer\n        room {\n          id\n          round\n        }\n        responses {\n          value\n          owner {\n            id\n            name\n          }\n        }\n      }\n      users {\n        id\n        name\n      }\n    }\n  }\n"]);return D=function(){return e},e}function Q(){var e=Object(I.a)(["\n  subscription SubscribeToRoom($roomId: uuid!) {\n    room_by_pk(id: $roomId) {\n      questions(order_by: { created_at: desc }) {\n        id\n        name\n        created_at\n        answer\n        responses {\n          value\n          owner {\n            name\n          }\n        }\n      }\n      users {\n        id\n        name\n      }\n    }\n  }\n"]);return Q=function(){return e},e}function F(){var e=Object(I.a)(["\n  query Room($name: String) {\n    room(where: { name: { _eq: $name } }, distinct_on: name) {\n      id\n      name\n      questions(order_by: { created_at: desc }) {\n        id\n        name\n        created_at\n        answer\n        responses {\n          value\n          owner {\n            name\n          }\n        }\n      }\n      users {\n        id\n        name\n      }\n    }\n  }\n"]);return F=function(){return e},e}function T(){var e=Object(I.a)(["\n  query UsersInRoomQuery($roomName: String) {\n    user(where: { room: { name: { _eq: $roomName } } }) {\n      id\n      name\n    }\n  }\n"]);return T=function(){return e},e}function z(){var e=Object(I.a)(["\n  subscription UsersInRoomSubscription($roomName: String) {\n    user(where: { room: { name: { _eq: $roomName } } }) {\n      id\n      name\n    }\n  }\n"]);return z=function(){return e},e}function B(){var e=Object(I.a)(["\n  mutation CreateUser($name: String, $roomId: uuid) {\n    insert_user(objects: [{ name: $name, room_id: $roomId }]) {\n      affected_rows\n      returning {\n        id\n        name\n        room {\n          name\n          id\n        }\n      }\n    }\n  }\n"]);return B=function(){return e},e}var J=C()(B()),M=(C()(z()),C()(T()),C()(F()),C()(Q()),C()(D())),G=C()(A()),L=(C()(R()),C()(x())),P=(C()(k()),C()(U())),Y=C()(N()),H=C()(y()),K=t(47),V=function(e){var n=e.component,t=e.loggedIn,r=e.path,a=Object(K.a)(e,["component","loggedIn","path"]);return m.a.createElement(f.b,Object.assign({path:r},a,{render:function(e){return t?m.a.createElement(n,e):m.a.createElement(f.a,{to:"/"})}}))},W=(t(69),m.a.createContext()),X=function(e){var n=e.handleSubmit,t=Object(s.useState)(null),r=Object(o.a)(t,2),a=r[0],u=r[1],c=Object(s.useState)(null),i=Object(o.a)(c,2),l=i[0],d=i[1];return console.log("name",l),m.a.createElement("form",{onSubmit:function(e){return n(e,{name:l,code:a})}},m.a.createElement("input",{value:l,onChange:function(e){return d(e.target.value)},placeholder:"Name"}),m.a.createElement("input",{value:a,onChange:function(e){return u(e.target.value)},placeholder:"Room Code"}),m.a.createElement("button",null,"submit"))},Z=function(e){var n=e.handleSubmit,t=Object(s.useState)(null),r=Object(o.a)(t,2),a=r[0],u=r[1],c=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,4).toUpperCase();return m.a.createElement("form",{onSubmit:function(e){return n(e,{name:a,code:c})}},m.a.createElement("input",{value:a,onChange:function(e){return u(e.target.value)},placeholder:"Name"}),m.a.createElement("button",null,"submit"))},ee=function(e){var n=e.data;return m.a.createElement("ul",null,n.map(function(e){return m.a.createElement("li",{key:e.id},e.name)}))},ne=function(e){var n=e.guess,t=e.answer;return m.a.createElement("div",null,m.a.createElement("div",null,"Your Answer: ",n),m.a.createElement("div",null,"Correct Answer: ",t),m.a.createElement("div",null,"Score: ",function(e,n){return e===n?-5:Math.abs(n-e)}(n,t)))},te=function(e){var n=e.data,t=e.roundOver,r=Object(s.useContext)(W).user,a=Object(s.useState)(null),u=Object(o.a)(a,2),l=u[0],d=u[1],b=Object(c.b)(L),f=Object(o.a)(b,1)[0],v=Object(c.b)(H),p=Object(o.a)(v,1)[0],j=i.a([i.b({owner:{id:r.id}})],n.responses);return j?n.answer&&t?m.a.createElement(m.a.Fragment,null,m.a.createElement(ne,{guess:j.value,answer:n.answer.score.rottenTomatoes}),m.a.createElement("button",{onClick:function(){p({variables:{roomId:n.room.id}})}},"next round")):m.a.createElement("div",null,m.a.createElement("span",null,"Current Answer: ",j.value),m.a.createElement("button",null,"end round")):m.a.createElement("div",null,m.a.createElement("h3",null,"Question id: ",n.id),m.a.createElement("h3",null,"User ID: ",r.id),m.a.createElement("span",null,r.name,"'s answer:"),m.a.createElement("form",{onSubmit:function(e){e.preventDefault(),f({variables:{userId:r.id,questionId:n.id,value:l}})}},m.a.createElement("input",{placeholder:"Answer",onChange:function(e){return d(e.target.value)},value:l}),m.a.createElement("button",null,"submit")))},re=function(e){var n=e.data,t=e.nUsers,r=e.roomId,i=Object(s.useState)(null),l=Object(o.a)(i,2),d=l[0],b=l[1],f=Object(c.b)(Y),v=Object(o.a)(f,1)[0],p=Object(s.useState)(!1),j=Object(o.a)(p,2),g=j[0],E=j[1];if(console.log("data.responses",n),Object(s.useEffect)(function(){n&&t===n.responses.length?E(!0):E(!1)},[n]),n)return console.log("data.responses",n.responses),m.a.createElement(m.a.Fragment,null,m.a.createElement("h3",null,"Question: ",n.name),m.a.createElement("h4",null,"Question State: ",n.state),m.a.createElement(te,{data:n,roundOver:g}));return m.a.createElement("div",null,m.a.createElement("form",{onSubmit:function(e){var n;e.preventDefault(),fetch((n=d,"https://kha9mwfrdb.execute-api.us-east-1.amazonaws.com/dev/search/".concat(n))).then(function(){var e=Object(u.a)(a.a.mark(function e(n){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:t=e.sent,console.log("here2",t),v({variables:{roomId:r,description:t.description,imageUrl:t.poster,name:t.title,answer:t.reception}}),b(null);case 6:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()).catch(function(e){console.error("error!",e)})}},m.a.createElement("input",{placeholder:"Question...",value:d,onChange:function(e){return b(e.target.value)}}),m.a.createElement("button",null,"submit")))},ae=function(e){var n=e.match.params.name,t=Object(c.c)(M,{variables:{name:n}});if(t.loading)return"Loading...";var r=t.data.room[0];return m.a.createElement("div",null,m.a.createElement("h1",null,r.name),m.a.createElement("h3",null,"Room ID: ",r.id),m.a.createElement("h4",null,"State: ",r.state),m.a.createElement(re,{data:r.questions[r.round],roomId:r.id,nUsers:r.users.length}),m.a.createElement(ee,{data:r.users}))},ue=function(){var e=Object(s.useState)(),n=Object(o.a)(e,2),t=n[0],r=n[1],a=Object(s.useContext)(W),u=a.user,i=a.setUser,l=Object(s.useState)(),d=Object(o.a)(l,2),b=d[0],v=d[1],p=Object(s.useState)({}),j=Object(o.a)(p,2),g=j[0],E=j[1],O=Object(f.g)(),h=Object(c.b)(J),w=Object(o.a)(h,2),$=w[0],_=w[1],S=Object(c.a)(G),I=Object(o.a)(S,2),q=I[0],C=I[1],y=Object(c.b)(P),N=Object(o.a)(y,2),U=N[0],k=N[1];Object(s.useEffect)(function(){C.loading||C.data&&C.data.room.length&&E(C.data.room[0])},[C]),Object(s.useEffect)(function(){g.id&&$({variables:{name:b,roomId:g.id}})},[g.id,b,$]),Object(s.useEffect)(function(){_.data&&i(_.data.insert_user.returning[0])},[_.data,i,O]),Object(s.useEffect)(function(){u&&O.push("/game/".concat(u.room.name))},[u,O]),Object(s.useEffect)(function(){k.data&&i(k.data.insert_user.returning[0])},[k]);var x=function(e,n){var r=n.name,a=n.code;e.preventDefault(),"join"===t?(q({variables:{name:a}}),v(r)):"create"===t&&U({variables:{userName:r,roomName:a}})};return t?"join"===t?m.a.createElement(X,{handleSubmit:x}):"create"===t?m.a.createElement(Z,{handleSubmit:x}):void 0:m.a.createElement("div",null,m.a.createElement("button",{onClick:function(){return r("create")}},"create"),m.a.createElement("button",{onClick:function(){return r("join")}},"join"))},oe=function(e){var n=e.children,t=Object(s.useState)(),r=Object(o.a)(t,2),a=r[0],u=r[1];return m.a.createElement(W.Provider,{value:{user:a,setUser:u}},n)},ce=function(){var e=Object(s.useContext)(W).user;return m.a.createElement(m.a.Fragment,null,m.a.createElement(f.b,{path:"/",exact:!0,component:ue}),m.a.createElement(V,{path:"/game/:name",component:ae,loggedIn:!!e}))};var ie=document.getElementById("root");b.a.render(m.a.createElement(function(){return m.a.createElement(l.a,{client:S},m.a.createElement(oe,null,m.a.createElement(v.a,{basename:"/"},m.a.createElement(f.d,null,m.a.createElement(ce,null)))))},null),ie)}},[[49,1,2]]]);
//# sourceMappingURL=main.20ee454d.chunk.js.map